version: '3.8'

#####################################
# Prepare:
# sudo mkdir /docker
# sudo chmod 777 /docker
#####################################

services:

  postgres:
    image: postgres:14.6
    container_name: postgres
    restart: always
    ports:
      - 5432:5432
    volumes:
      # data:
      - /docker/postgres/data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=123456hui

  mariadb:
    # image: mysql:5.7.24
    # image: mysql:8.0.18
    image: mariadb:10.10.2
    container_name: mariadb
    restart: always
    # command: --default-authentication-plugin=mysql_native_password
    volumes:
      # data:
      - /docker/mariadb/data:/var/lib/mysql
      # - ./mysql5:/var/lib/mysql
      # - ./mysql8:/var/lib/mysql
      # - ./mariadb:/var/lib/mysql
      # ---------------------------------------
      # configuration file
      # - /docker/mariadb/conf:/etc/mysql/conf.d
      - ./config/mariadb/conf:/etc/mysql/conf.d
    ports:
      - 3308:3306
    environment:
      MARIADB_ROOT_PASSWORD: 123456hui
      # MARIADB_DATABASE: example
      # MARIADB_USER: example
      # MARIADB_PASSWORD: example

  # https://www.jianshu.com/p/094078ef4347
  # https://www.php1.cn/detail/ZuiXiangXiDe_doc_26f5dcb1.html
  redis:
    image: redis:7.0.5
    container_name: redis
    restart: always
    ports:
      - 6379:6379
    environment:
      TZ: Asia/Shanghai
    volumes:
      # configure file
      #- ./config/redis/conf:/usr/local/etc/redis
      - ./config/redis/conf:/redis/config
      # data file
      - /docker/redis/data:/data
      # log file
      # - /docker/redis/logs:/logs
    command: "redis-server /redis/config/redis.conf"
    privileged: true

  pgadmin4:
    image: dpage/pgadmin4
    container_name: pgadmin4
    restart: always
    ports:
      - 8001:80
    environment:
      - PGADMIN_LISTEN_ADDRESS=0.0.0.0
      # - PGADMIN_LISTEN_PORT=80
      - PGADMIN_DEFAULT_EMAIL=test@test.com
      - PGADMIN_DEFAULT_PASSWORD=123456
    
  phpmyadmin:
    image: phpmyadmin:5.2.0
    container_name: phpmyadmin
    restart: always
      # depends_on:
      # - db
    volumes: 
      # - /docker/phpmyadmin/config.user.inc.php:/etc/phpmyadmin/config.user.inc.php
      - ./config/phpmyadmin/config.user.inc.php:/etc/phpmyadmin/config.user.inc.php
    environment:
      - PMA_ARBITRARY=1
    ports:
      - 8002:80

  redisinsight:
    image: redislabs/redisinsight
    container_name: redisinsight
    ports:
      - 8003:8001
